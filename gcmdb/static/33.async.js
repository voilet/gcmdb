(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[33],{"4bvw":function(e,t,a){"use strict";var s=a("284h"),l=a("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("g9YV");var r=l(a("wCAj"));a("fOrg");var i=l(a("+KLJ"));a("OaEy");var n=l(a("2fM7")),d=l(a("MVZn"));a("5NDa");var o=l(a("5rEg")),h=s(a("q1tI")),c=(l(a("wd/R")),l(a("Hdkd"))),u=e=>{var t=e.editable,a=e.value,s=e.onChange;return h.default.createElement("div",null,t?h.default.createElement(o.default,{style:{margin:"-5px 0"},value:a,onChange:e=>s(e.target.value)}):a)};class p extends h.PureComponent{constructor(){super(...arguments),this.state={selectedRowKeys:[],totalCallNo:0,data:[]},this.handleRowSelectChange=((e,t)=>{var a=t.reduce((e,t)=>{return e+parseFloat(t.callNo,10)},0);this.props.onSelectRow&&this.props.onSelectRow(t),this.setState({selectedRowKeys:e,totalCallNo:a})}),this.handleTableChange=((e,t,a)=>{this.props.onChange&&this.props.onChange(e,t,a)}),this.cleanSelectedKeys=(()=>{this.handleRowSelectChange([],[])}),this.handleDeleteData=(e=>{this.props.dispatch({type:"gproline/deleteProjectLine",payload:e})})}componentWillReceiveProps(e){0===e.selectedRows.length&&this.setState({selectedRowKeys:[],totalCallNo:0}),this.setState({data:e.hostdata.map(e=>{return void 0==e.selectStatus&&(e.selectStatus=!0),e})})}renderColumns(e,t,a){return h.default.createElement(u,{editable:t.editable,value:e,onChange:e=>this.handleChange(e,t.ID,a)})}edit(e){var t=[...this.state.data],a=t.filter(t=>e===t.ID)[0];a&&(a.editable=!0,this.setState({data:t.map(t=>{return e==t.ID&&(t.selectStatus=!1),t}),disabled:!1}))}save(e){var t=[...this.state.data],a=t.filter(t=>e===t.ID)[0];a&&(delete a.editable,a.enable=this.state.status,this.setState({data:t.map(t=>{return e==t.ID&&(t.selectStatus=!0),t}),disabled:!0}),this.cacheData=t.map(e=>(0,d.default)({},e)),console.log("target",a),this.props.handleSaveData(a))}cancel(e){var t=[...this.state.data],a=t.filter(t=>e===t.ID)[0];a&&(Object.assign(a,this.cacheData.filter(t=>e===t.ID)[0]),delete a.editable,this.setState({data:t.map(t=>{return e==t.ID&&(t.selectStatus=!0),t}),disabled:!0}))}askdelete(e){var t=[...this.state.data],a=t.filter(t=>e===t.ID)[0];a&&(a.deleteable=!0,this.setState({data:t}))}confirmdelete(e){var t=[...this.state.data],a=t.filter(t=>e===t.ID)[0];if(a){var s=t.indexOf(a);s>-1&&t.splice(s,1),a.tag=!1,this.setState({data:t}),this.cacheData=t.map(e=>(0,d.default)({},e)),this.handleDeleteData(e)}}handleChange(e,t,a){var s=[...this.state.data],l=s.filter(e=>t===e.ID)[0];l&&(l[a]=e,this.setState({data:s,disabled:!1}))}render(){var e=this.state,t=e.selectedRowKeys,a=(e.totalCallNo,e.data),s=this.props,l=s.loading,o=(s.hostdata,[{title:"\u4e3b\u673aIP",dataIndex:"ip",key:"ip",width:"pro",render:(e,t)=>this.renderColumns(e,t,"ip")},{title:"FQDN",dataIndex:"fqdn",key:"fqdn",width:"pro",className:"xs-hide",render:(e,t)=>this.renderColumns(e,t,"fqdn")},{title:"\u521b\u5efa\u65f6\u95f4",dataIndex:"created_at",key:"created_at",width:"pro",className:"xs-hide",render:(e,t)=>{var a=t.created_at,s={color:"red"};return h.default.createElement("div",{style:s},a.substr(0,10))}},{title:"\u6743\u9650",dataIndex:"auth",key:"auth",width:"100px",render:(e,t)=>{var a=this.props.auths||[],s=parseInt(t.permissionid)>0?parseInt(t.permissionid):"\u4fee\u6539\u6743\u9650";return h.default.createElement(n.default,{style:{width:100},defaultValue:"\u4fee\u6539\u6743\u9650",value:s,onSelect:e=>{this.props.onSelectAuth&&this.props.onSelectAuth([t],e)}},a.map(e=>h.default.createElement(n.default.Option,{value:e.ID},e.title)))}},{title:"\u64cd\u4f5c",dataIndex:"option",width:"180px",render:(e,t)=>{var s=this.props.option;if(s){var l=[];for(var r in s){var i=s[r],n=i.props||{},o=(0,d.default)({},n);o.onClick=function(e){return function(){e.onClick&&e.onClick(a,t)}}(i);var c=[];c="function"==typeof i.childs?i.childs(a,t):i.childs;var u=!i.visible||i.visible(a,t),p=h.default.createElement(i.tag,o,c);u&&l.push(p)}return h.default.createElement("div",null," ",l)}return h.default.createElement("div",null)}}]),u={showSizeChanger:!0,showQuickJumper:!0},p={selectedRowKeys:t,onChange:this.handleRowSelectChange,getCheckboxProps:e=>({disabled:e.disabled})};return this.cacheData=this.state.data.map(e=>(0,d.default)({},e)),h.default.createElement("div",{className:c.default.standardTable},h.default.createElement("div",{className:c.default.tableAlert},h.default.createElement(i.default,{message:h.default.createElement("div",null,"\u5df2\u9009\u62e9 ",h.default.createElement("a",{style:{fontWeight:600}},t.length)," \u4e2a\u9879\u76ee\xa0",h.default.createElement("a",{onClick:this.cleanSelectedKeys,style:{marginLeft:24}},"\u53d6\u6d88\u52fe\u9009")),type:"info",showIcon:!0})),h.default.createElement(r.default,{loading:l,rowKey:e=>e.id,rowSelection:p,dataSource:a,columns:o,pagination:u,onChange:this.handleTableChange}))}}var f=p;t.default=f},Hdkd:function(e,t,a){e.exports={standardTable:"antd-pro-components-project-table-pro-host-index-standardTable",tableAlert:"antd-pro-components-project-table-pro-host-index-tableAlert"}},g8d6:function(e,t,a){"use strict";var s=a("TqRt"),l=a("284h");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("IzEo");var r=s(a("bx4M"));a("+L6B");var i=s(a("2/Rp"));a("/zsF");var n=s(a("PArb"));a("2qtc");var d=s(a("kLXV"));a("miYZ");var o=s(a("tsqr"));a("5NDa");var h=s(a("5rEg"));a("7Kak");var c=s(a("9yH6"));a("OaEy");var u,p,f,m=s(a("2fM7")),v=l(a("q1tI")),g=a("MuoO"),y=s(a("4bvw")),b=s(a("yca4")),I=(s(a("npf6")),s(a("NPSK"))),S=(m.default.Option,c.default.Group),w=h.default.Group,C=(u=(0,g.connect)(e=>e),u((f=class extends v.PureComponent{constructor(){super(...arguments),this.state={expandForm:!1,selectedRows:[],formValues:{},resourcedata:[],modalVisible:!1,modalAuthVisible:!1,selectedUserInfo:null,selectedProjectInfo:null,filterIp:"",currentHostInfo:{},permissionid:-1,parentdata:[]},this.handleRefreshTableChange=(()=>{var e=this.props.dispatch;e({type:"gproline/getProjectLine",payload:""})}),this.queryHosts=(()=>{var e={ip:this.state.filterIp,user_id:this.state.selectedUserInfo?this.state.selectedUserInfo.ID:"",project_id:this.state.selectedProjectInfo?this.state.selectedProjectInfo.ID:""};console.log("\u67e5\u8be2\u4e3b\u673a",e),this.props.dispatch({type:"gforthost/searchHost",payload:{params:e}})}),this.getFirstPermssionId=(()=>{var e=this.props.guser,t=e.ssh_role;return t&&t.length?t[0].ID:0}),this.checkUserAndHost=(e=>{var t=this.state.selectedUserInfo,a=this.state.selectedRows,s=!0,l=!0;return console.log("checkUserAndHost",t,a,e),t&&t.ID||(s=!1),e&&e.length||a&&a.length||(l=!1),s?!!l||(o.default.error("\u8bf7\u9009\u62e9\u4e00\u4e2a\u53f0\u4e3b\u673a"),!1):(o.default.error("\u8bf7\u9009\u62e9\u4e00\u4e2a\u7528\u6237"),!1)}),this.handleSelectRows=(e=>{this.setState({selectedRows:e})}),this.handleSearchIP=(e=>{this.state.filterIp=e,this.queryHosts()}),this.handlerSelect=((e,t)=>{console.log("val",t);var a=this.props,s=a.guser,l=a.gforthost,r=(a.dispatch,[]),i=[];try{r=s.data.data.user_infos||[]}catch(e){}try{i=l.projectlist.data}catch(e){}switch(e){case"user":var n=r.filter(e=>{return e.ID==t});n.length&&(this.state.selectedUserInfo=n[0]);break;case"project":var d=i.filter(e=>{return e.ID==t});d.length&&(this.state.selectedUserInfo=d[0]);break}this.queryHosts()}),this.handleModalInfoHide=(()=>{this.setState({modalVisible:!1})}),this.handleModalInfoShow=(e=>{console.log("data",e),e&&this.setState({currentHostInfo:e,modalVisible:!0})}),this.handleAuthorizeShow=(e=>{this.state.selectedUserInfo;var t=this.props.dispatch,a=this.checkUserAndHost(),s=this.state.selectedRows;s&&1==s.length&&(this.state.permisionid=s[0].permisionid,this.setState({permisionid:s[0].permisionid})),a&&(this.getFirstPermssionId()?this.setState({permissionid:this.getFirstPermssionId(),modalAuthVisible:!0}):t({type:"guser/fetchSSHRoleList",payload:{callback:e=>{this.setState({permissionid:this.getFirstPermssionId(),modalAuthVisible:!0})}}}))}),this.handleAuthorizeCancel=(()=>{this.setState({modalAuthVisible:!1})}),this.handleAuthorizeDelete=(e=>{var t=this.checkUserAndHost(e);if(t){var a=[];a=e&&e.length?e.concat():this.state.selectedRows;var s=this.state.selectedUserInfo,l=a.map(e=>e.id).join(",");console.log("\u6267\u884c\u5220\u9664\u6388\u6743\u64cd\u4f5c",s,l,a),this.props.dispatch({type:"guser/deleteSSHPermission",payload:{params:{ID:s.ID,hosts:l},callback:()=>{o.default.success("\u64cd\u4f5c\u6210\u529f"),this.handleAuthorizeCancel()}}})}}),this.handleAuthorize=((e,t)=>{var a=this.checkUserAndHost(e);if(a){var s=[];s=e&&e.length?e.concat():this.state.selectedRows;var l=this.state.selectedUserInfo,r=s.map(e=>e.id).join(",");console.log("\u6267\u884c\u6388\u6743\u64cd\u4f5c",l,r,s),t||(t=this.state.permissionid),isNaN(t)?o.default.error("\u66f4\u65b0\u6743\u9650\u51fa\u9519\uff0c\u53c2\u6570\u5f02\u5e38"):this.props.dispatch({type:"guser/modifySSHPermission",payload:{params:{ID:l.ID,hosts:r,permissionid:t},callback:()=>{o.default.success("\u64cd\u4f5c\u6210\u529f"),this.handleAuthorizeCancel()}}})}}),this.handlePermissionChange=(e=>{this.state.permissionid=e.target.value})}componentDidMount(){var e=this.props.dispatch;e({type:"guser/fetch"}),e({type:"gforthost/getProjects"}),e({type:"guser/fetchSSHRoleList"}),this.queryHosts()}render(){var e=this.state,t=e.selectedRows,a=(e.parentdata,this.props),s=(a.gresource,a.guser),l=a.gforthost,o=a.dispatch,u=[],p=[],f=l.hosts.data||[],g=this.state.selectedUserInfo?this.state.selectedUserInfo.username:"",C=s.ssh_role||[];try{u=s.data.data.user_infos}catch(e){}try{p=l.projectlist.data}catch(e){}console.log("ForthostList Render:",this.props);var E=(e,t)=>{return e=e||[],"projects"==t?e.map(e=>v.default.createElement(m.default.Option,{value:e.ID},e.pro_title," ")):e.map(e=>v.default.createElement(m.default.Option,{value:e.ID},e.title||e.username||e.remarks," "))},D=!0;return v.default.createElement("div",null,v.default.createElement(d.default,{title:"\u67e5\u770b\u4e3b\u673a\u8be6\u60c5",visible:this.state.modalVisible,onOk:()=>this.handleModalInfoHide(),width:600,onCancel:()=>this.handleModalInfoHide()},v.default.createElement(b.default,{info:this.state.currentHostInfo})),v.default.createElement(d.default,{title:`\u4fee\u6539\u7528\u6237" ${g}"\u7684\u6743\u9650`,visible:this.state.modalAuthVisible,onCancel:()=>this.handleAuthorizeCancel(),onOk:()=>this.handleAuthorize()},v.default.createElement("div",null,v.default.createElement(S,{onChange:this.handlePermissionChange},C.map(e=>{return v.default.createElement(c.default,{value:e.ID},e.remarks+"("+e.title+")")})))),v.default.createElement(r.default,{bordered:!1},v.default.createElement("div",{className:I.default.tableList},v.default.createElement("div",null,v.default.createElement(m.default,{showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.join("").toLowerCase().indexOf(e.toLowerCase())>=0,style:{marginRight:10,marginBottom:10,width:100,float:"left"},defaultValue:"\u9009\u62e9\u7528\u6237",onSelect:e=>{this.handlerSelect("user",e)}},E(u,"role")),v.default.createElement(m.default,{showSearch:!0,optionFilterProp:"children",filterOption:(e,t)=>t.props.children.join("").toLowerCase().indexOf(e.toLowerCase())>=0,style:{marginRight:10,marginBottom:10,width:150,float:"left"},defaultValue:"\u9009\u62e9\u9879\u76ee",onSelect:e=>{this.handlerSelect("project",e)}},E(p,"projects")),v.default.createElement(w,{compact:!1,style:{display:"inline-block",width:"auto",float:"left"}},v.default.createElement(h.default.Search,{placeholder:"\u8bf7\u8f93\u5165ip\u8fdb\u884c\u6a21\u7cca\u641c\u7d22",enterButton:"\u641c\u7d22",onSearch:this.handleSearchIP,style:{width:300}}))),v.default.createElement(n.default,{style:{paddingTop:10}}," \u4e3b\u673a\u5217\u8868 "),v.default.createElement(y.default,{selectedRows:t,dispatch:o,handleSaveData:this.handleSaveData,handleDeleteData:this.handleDeleteData,onSelectAuth:this.handleAuthorize,auths:C,hostdata:f,option:{more:{tag:"Button",props:{type:"button",className:"ant-btn"},onClick:(e,t)=>{console.log("rowdtaa",t),this.handleModalInfoShow(t)},childs:"\u8be6\u60c5"},auth_delete:{tag:"Button",props:{type:"button",className:"ant-btn"},onClick:(e,t)=>{this.handleAuthorizeDelete([t])},visible:(e,t)=>{return-1!=t.permissionid},childs:()=>{return"\u5220\u9664\u6743\u9650"}}},onSelectRow:this.handleSelectRows,onChange:this.handleStandardTableChange})),v.default.createElement("div",{style:{paddingTop:20}},v.default.createElement(i.default,{type:"primary",disabled:!D,onClick:()=>this.handleAuthorizeShow(),style:{marginRight:10}},"\u6279\u91cf\u6388\u6743"),v.default.createElement(i.default,{type:"danger",disabled:!D,onClick:()=>this.handleAuthorizeDelete()},"\u6279\u91cf\u5220\u9664\u6388\u6743"))))}},p=f))||p);t.default=C},yca4:function(e,t,a){"use strict";var s=a("284h"),l=a("TqRt");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("14J3");var r=l(a("BMrR"));a("jCWc");var i=l(a("kPKH")),n=l(a("MVZn")),d=s(a("q1tI")),o=(l(a("wd/R")),l(a("s6jc")));class h extends d.PureComponent{constructor(){super(...arguments),this.state={lng:{},info:{}}}componentWillReceiveProps(e){e.info&&this.setState((0,n.default)({},this.state,{info:(0,n.default)({},e.info)})),e.langMap&&this.setState((0,n.default)({},this.state,{lng:(0,n.default)({},e.langMap)}))}render(){var e=this.props.info,t=(e,t)=>d.default.createElement(r.default,{gutter:24},d.default.createElement(i.default,{span:8,key:1,style:{display:"block"}},e),d.default.createElement(i.default,{span:16,key:1,style:{display:"block"}},t)),a=e=>{var a=[];for(var s in e)a.push(t(s,e[s]));return a};return d.default.createElement("div",{className:o.default.standardTable},d.default.createElement("div",null,a({"\u5c5e\u6027":"\u503c"})),d.default.createElement("div",null,a(e)))}}var c=h;t.default=c}}]);